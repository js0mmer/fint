


<link rel="import" href="imports.html">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>


<dom-module id="fint-app">
  <template>

<paper-drawer-panel>
  <paper-scroll-header-panel drawer>
    <paper-toolbar>  <div id="search"><paper-input label="Search here.."value="{{keyword::input}}" >
  <paper-icon-button suffix on-tap="ready" icon="search" alt="search" title="search">  </paper-icon-button>
    </paper-input>

  </div> </paper-toolbar>

  <div id='greeting'></div>
  <iron-selector selected="{{selected}}">
     <div id='signinbutton'><paper-button  raised on-tap="signInGPlus">Sign In With Google</paper-button></div>
     <div>Home/Search</div>
    <div id='playlistSelector'></div>
   </iron-selector>
    <div> Search and enjoy...<br>More stuff coming soon.. </div>
  </paper-scroll-header-panel>
  <paper-scroll-header-panel main>
    <paper-toolbar> <paper-button on-tap='init'> <h1>HPT</h1> </paper-button></paper-toolbar>
    <div>
      <iron-pages selected='{{selected}}'>
        <section>
          <div class='main' class="horizontal-section-container">
            <template is="dom-bind" id="app">

              <iron-ajax auto
                  url="https://www.googleapis.com/youtube/v3/search"
                  params='{{params}}'
                  handle-as="json"
                  loading="{{loading}}"
                  last-response="{{ajaxResponse}}"></iron-ajax>
  <template is="dom-if" if="{{loading}}" ><paper-spinner active ></paper-spinner></template>
      <div id="playlist">
                <template is="dom-repeat" items="[[ajaxResponse.items]]">
                    <span id="list">
                  <paper-card image="[[item.snippet.thumbnails.high.url]]"class="rate">
                    <div class="rate-content">
                      <div class="card-content">
                        <div class="rate-header">
<a  href="[[sURL(item.id.videoId,item.snippet.title)]]">
                   <iron-icon  class="big"icon="av:play-circle-filled" ></iron-icon>
                        </a>[[item.snippet.title]] </div>





                      <div class="card-actions">

                      </div>
                    </div>

                  </paper-card>
                </span>



                </template>
              </section>
              <section>Playlists..</section>
                </iron-pages>
                <paper-toolbar id="footer">

                  <audio id="audio" preload="auto" tabindex="0" controls="" type="audio/mpeg">
            <source type="audio/mp3" src="">
            Sorry, your browser does not support HTML5 audio.
        </audio>
                </paper-toolbar>
    </div>
            </template>
          </div>

          <script>

          var app = document.querySelector('#app');
          app.url = function (videoId) {
            return 'https://www.youtube.com/watch?v=' + videoId;

          //  document.querySelector('music-player').href = 'https://www.youtube.com/watch?v=' + videoId;
          };
          app.channel = function(channelId){
            return '/#/channel/'+ channelId;
          };
          app.init = function(items){
          console.log(items)


          };
          app.current= function(title){
          document.getElementById('currently').innerHTML = title;

          };
          function push(title){
          alert(title)
          };
          app.embed = function(videoId){
            return 'https://youtube.com/embed/' +videoId;
          };

          app.sURL = function(videoId){

          var url ='https://www.youtube.com/watch?v=' + videoId;
          var endpoint ="/backend/index.php?url="+url;

          $.ajax({type: "GET", url: endpoint, async: false, dataType: "text", success: function (data, textStatus, jqXHR) {s = data;} });
            return s;
          };
          app.params = {"part":"snippet", "q":"efwgre", "key": "AIzaSyAuecFZ9xJXbGDkQYWBmYrtzOGJD-iDIgI", "type": "video"}

          </script></div>

  </paper-scroll-header-panel>
</paper-drawer-panel>



  </template>

  <script>
    Polymer({

      is: 'fint-app',

      properties: {

        keyword: {
          type: String,
          value: 'Music',


        },
        database: {
          type: Object,
        },
        loading: {
         type: Boolean,

       },
       user:{
         type:Object,
       },
       token:{
         type:Object,
       },
       selected:{
         type:Number,
         value:0,
       },

      },
      ready:function(){
        var app = document.querySelector('#app');
app.params = {"part":"snippet", "q":this.keyword, "key": "AIzaSyAuecFZ9xJXbGDkQYWBmYrtzOGJD-iDIgI", "type": "video"}
//Routes
page('/search/'+this.keyword);
page('/search/:id', function(context){
  var query = context.params.id;
  console.log('Loading results for ', query);
  this.keyword= query;
    });
//Database and Firebase
  var config = {
    apiKey: "AIzaSyCFbQZfcARx4whf5OnaksP6FKkhuDupU14",
  authDomain: "finty-c6733.firebaseapp.com",
  databaseURL: "https://finty-c6733.firebaseio.com",
  storageBucket: "finty-c6733.appspot.com",
  messagingSenderId: "940413361703"
  };
  firebase.initializeApp(config);


   this.database = firebase.database();
  console.log(this.database)

page();
      },
      signInGPlus: function(){

        var provider = new firebase.auth.GoogleAuthProvider();
        provider.addScope('https://www.googleapis.com/auth/plus.login');
        firebase.auth().signInWithPopup(provider).then(function(result) {
          // This gives you a Google Access Token. You can use it to access the Google API.
        this.token = result.credential.accessToken;
          // The signed-in user info.
           this.user = result.user;
      console.log(this.user, this.token);
      console.log(this.user.displayName)
      greeting = document.querySelector('#greeting');
      greeting.innerHTML = '<paper-card image="'+this.user.photoURL+'"><h1>Hi, '+this.user.displayName+' </h1></paper-card>';
playlistSelector = document.querySelector('#playlistSelector');
playlistSelector.innerHTML='Playlist'
$("#signinbutton").remove();
          // ...
        }).catch(function(error) {
          // Handle Errors here.
          var errorCode = error.code;
          alert('Error logging into Google Plus..', 'You must have done something wrong, or it is just me, just assume it was me :)')
          var errorMessage = error.message;
          // The email of the user's account used.
          var email = error.email;
          // The firebase.auth.AuthCredential type that was used.
          var credential = error.credential;
          // ...

      });



      },
      init: function(){
        var audio;
        var playlist;
        var tracks;
        var current;


            current = 0;
            audio = $('audio');
            playlist = $('#playlist');
            tracks = playlist.find('#list a');
            len = tracks.length - 1;
            audio[0].volume = 1;
            audio[0].play();
            playlist.find('a').click(function(e){
                e.preventDefault();
                link = $(this);
                current = link.parent().index();
                run(link, audio[0]);
            });
            audio[0].addEventListener('ended',function(e){
                current++;
                if(current == len){
                    current = 0;
                    link = playlist.find('a')[0];
                }else{
                    link = playlist.find('a')[current];
                }
                run($(link),audio[0]);
            });

        function run(link, player){
                player.src = link.attr('href');
                par = link.parent();
                par.addClass('active').siblings().removeClass('active');
                audio[0].load();
                audio[0].play();
        }

      },
      thething: function(thing){
      alert(thing)


      },




    });
  </script>
</dom-module>
